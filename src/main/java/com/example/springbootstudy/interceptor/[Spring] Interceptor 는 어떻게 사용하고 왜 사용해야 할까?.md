# [Spring] Interceptor 는 어떻게 사용하고 왜 사용해야 할까?

### 들어가기전.

Interceptor 는 filter와 유사하다. 요청 응답의 정보가 전달 되면 전 후 처리를 할 수 있다. 정보를 가로 채서 컨트롤 할 수 있다.

주로 인증 단계나 필터와 같이 로깅 작업을 할 수 있다. Interceptor는 계층 구조로 하나의 interceptor가 실행되고 또 하나의 interceptor를 추가해 단계 별로 인증체크를 할 수 있다.

### 사용법을 알아가기 전에 Filter와의 차이점은 무엇일까?

아래의 구성도를 살펴보자.

![img.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/img.png)

필터는 스프링 컨텍스트 외부에서 적용이 되고 인터셉터는 스프링 컨텍스트 내부에서 적용이 되고 있다.

필터의 `doFilter()` 메서드의 매개변수도 살펴보자.

![스크린샷 2022-07-30 오후 4.44.13.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/_2022-07-30__4.44.13.png)

컨텍스트의 Object가 존재하지 않는다.

인터셉트의 메서드의 매개변수를 살펴보자.

![스크린샷 2022-07-30 오후 4.48.56.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/_2022-07-30__4.48.56.png)

핸들러를 할 수 있는 Object가 존재한다. 우리는 이 Object 매개변수로 권한 체크를 할 수 있고 여러가지 작업을 할 수 있다.

HttpServlet 매개변수로 필터와 마찬가지로 요청 응답에 대한 정보들을 컨틀롤 할 수 있다.

인터셉터와 필터의 차이점을 정리해보면 인터셉터는 스프링 컨텍스트 내부에서 적용되며 핸들러 정보를 사용할 수 있고 필터는 스프링 컨텍스트 외부에서 적용되며 핸들러 정보를 가질 수 없다.

### 사용법

![스크린샷 2022-07-30 오후 4.55.38.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/_2022-07-30__4.55.38.png)

`HandlerInterceptor` 인터페이스를 구현하여 Bean으로 등록해준다.

다음으로 메서드를 구현하는데 핸들러를 호출하기 전 후 뷰가 로딩된 후로 구성 되어있다.

![스크린샷 2022-07-30 오후 5.06.35.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/_2022-07-30__5.06.35.png)

- preHandle : 핸들러를 호출 하기 전
- postHandle : 핸들러를 호출 한 후
- afterCompletion : 뷰가 로딩 된 후 무조건 호출

![스크린샷 2022-07-30 오후 5.07.38.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/_2022-07-30__5.07.38.png)

정상적으로 동작이 되게 하려면 빠진 것이 있다.

인터셉터를 생성하여 빈으로 등록 한 다음  인터셉터 추가 해 줘야 한다.

![스크린샷 2022-07-30 오후 5.29.19.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/_2022-07-30__5.29.19.png)

### 에노테이션을 활용하여 권한 체크 해보기

@Auth 에노테이션을 생성한다.

![스크린샷 2022-07-30 오후 5.34.21.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/_2022-07-30__5.34.21.png)

에노테이션이 선언 되어 있나 확인하여 로직을 작성한다.

![스크린샷 2022-07-30 오후 5.43.45.png](%5BSpring%5D%20Interceptor%20%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%80%E1%85%A9%20%E1%84%8B%E1%85%AB%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%20b0a76636e53a4efe98c2c76bf19a0a24/_2022-07-30__5.43.45.png)

.